<div class="date-picker-container" tabindex="0" (keydown)="onKeyDown($event)">
  <label>Modern Date Picker</label>

  <div class="input-wrapper" (click)="toggleCalendar()">
    <div class="segmented-input" (click)="$event.stopPropagation()">

      <div
        class="segment"
        [class.active]="activePart === 'month'"
        (click)="setActive('month')"
      >
        <span class="placeholder" [class.hidden]="month.length > 0 || activePart === 'month'">MM</span>
        <input
          type="text"
          maxlength="2"
          [(ngModel)]="month"
          (focus)="setActive('month')"
          (input)="onSegmentInput('month', $event)"
          [value]="month"
        />
      </div>

      <span class="divider">/</span>

      <div
        class="segment"
        [class.active]="activePart === 'day'"
        (click)="setActive('day')"
      >
        <span class="placeholder" [class.hidden]="day.length > 0 || activePart === 'day'">DD</span>
        <input
          type="text"
          maxlength="2"
          [(ngModel)]="day"
          (focus)="setActive('day')"
          (input)="onSegmentInput('day', $event)"
          [value]="day"
        />
      </div>

      <span class="divider">/</span>

      <div
        class="segment"
        [class.active]="activePart === 'year'"
        (click)="setActive('year')"
      >
        <span class="placeholder" [class.hidden]="year.length > 0 || activePart === 'year'">YYYY</span>
        <input
          type="text"
          maxlength="4"
          [(ngModel)]="year"
          (focus)="setActive('year')"
          (input)="onSegmentInput('year', $event)"
          [value]="year"
        />
      </div>
    </div>

    @if (selectedDate) {
      <button class="clear-btn" (click)="clearDate(); $event.stopPropagation()">×</button>
    }

    <mat-icon class="icon" (click)="onIconClick($event)">calendar_today</mat-icon>
  </div>

  @if (showCalendar) {
    <div class="calendar">
      <div class="header">
        <button (click)="prevMonth()">‹</button>
        <span>{{ months[displayMonth.getMonth()] }} {{ displayMonth.getFullYear() }}</span>
        <button (click)="nextMonth()">›</button>
      </div>

      <div class="weekdays">
        @for (d of ['S','M','T','W','T','F','S']; track d) {
          <div>{{ d }}</div>
        }
      </div>

      <div class="days">
        @for (day of daysInMonth; track day) {
          <div
            [class.empty]="!day"
            [class.selected]="selectedDate && day && day.toDateString() === selectedDate.toDateString()"
            [class.focused]="focusedDate && day && day.toDateString() === focusedDate.toDateString()"
            (click)="selectDate(day)"
          >
            {{ day ? day.getDate() : '' }}
          </div>
        }
      </div>
    </div>
  }
</div>
