<div class="date-picker-container" #container tabindex="0">
  <label> Date Picker</label>

  <div class="input-wrapper" (click)="toggleCalendar()">
    <div class="segmented-input" (click)="$event.stopPropagation()">

      <div
        class="segment"
        [class.active]="activePart === 'month'"
        (click)="setActive('month')"
      >
        <span class="placeholder" [class.hidden]="month.length > 0 || activePart === 'month'">MM</span>
        <input
          #monthInput
          type="text"
          maxlength="2"
          [value]="month"
          (focus)="setActive('month')"
          (input)="onSegmentInput('month', $event)"
          (keydown)="onKeyDown($event); $event.stopPropagation()"
        />
      </div>

      <span class="divider">/</span>

      <div
        class="segment"
        [class.active]="activePart === 'day'"
        (click)="setActive('day')"
      >
        <span class="placeholder" [class.hidden]="day.length > 0 || activePart === 'day'">DD</span>
        <input
          #dayInput
          type="text"
          maxlength="2"
          [value]="day"
          (focus)="setActive('day')"
          (input)="onSegmentInput('day', $event)"
          (keydown)="onKeyDown($event); $event.stopPropagation()"
        />
      </div>

      <span class="divider">/</span>

      <div
        class="segment"
        [class.active]="activePart === 'year'"
        (click)="setActive('year')"
      >
        <span class="placeholder" [class.hidden]="year.length > 0 || activePart === 'year'">YYYY</span>
        <input
          #yearInput
          type="text"
          maxlength="4"
          [value]="year"
          (focus)="setActive('year')"
          (input)="onSegmentInput('year', $event)"
          (keydown)="onKeyDown($event); $event.stopPropagation()"
        />
      </div>
    </div>

    @if (selectedDate) {
      <button class="clear-btn" (click)="clearDate(); $event.stopPropagation()">×</button>
    }

    <mat-icon class="icon" (click)="onIconClick($event)">calendar_today</mat-icon>
  </div>

  @if (showCalendar) {
    <div class="calendar show" [class.above]="calendarPosition === 'above'" [class.below]="calendarPosition === 'below'">
      <div class="header">
        <button (click)="prevMonth()">‹</button>
        <div class="month-year-selector">
          <button class="month-btn" (click)="toggleMonthSelector(); $event.stopPropagation()">{{ months[displayMonth.getMonth()] }}</button>
          <button class="year-btn" (click)="toggleYearSelector(); $event.stopPropagation()">{{ displayMonth.getFullYear() }}</button>
        </div>
        <button (click)="nextMonth()">›</button>
      </div>

      @if (showMonthSelector) {
        <div class="month-selector">
          @for (month of months; track month; let i = $index) {
            <button
              [class.selected]="i === displayMonth.getMonth()"
              (click)="selectMonth(i); $event.stopPropagation()"
            >{{ month }}</button>
          }
        </div>
      }

      @if (showYearSelector) {
        <div class="year-selector" #yearSelector>
          @for (year of years; track year) {
            <button
              [class.selected]="year === displayMonth.getFullYear()"
              [attr.data-year]="year"
              (click)="selectYear(year); $event.stopPropagation()"
            >{{ year }}</button>
          }
        </div>
      }

      @if (!showMonthSelector && !showYearSelector) {
        <div class="weekdays">
          @for (d of ['S','M','T','W','T','F','S']; track d) {
            <div>{{ d }}</div>
          }
        </div>

        <div class="days">
          @for (day of daysInMonth; track day) {
            <div
              [class.empty]="!day"
              [class.selected]="selectedDate && day && day.toDateString() === selectedDate.toDateString()"
              [class.focused]="focusedDate && day && day.toDateString() === focusedDate.toDateString()"
              (click)="selectDate(day)"
            >
              {{ day ? day.getDate() : '' }}
            </div>
          }
        </div>
      }
    </div>
  }
</div>
